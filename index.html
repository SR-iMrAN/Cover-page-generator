<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DIU Cover Craft</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<style>
:root{
  --ui-bg:#eef2fb;--ui-surface:#ffffff;--ui-border:#c8d5ee;--ui-accent:#2d54b8;
  --ui-text:#1a2540;--ui-muted:#4e5f80;--ui-ph:#9aabc8;--ui-input-b:#c0ceeb;
  --ui-header:#1a2d62;--ui-sec-bg:#edf1fb;
}
*{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;}
body{background:var(--ui-bg);color:var(--ui-text);font-family:'Inter',sans-serif;min-height:100vh;}

header{background:var(--ui-header);padding:0 20px;height:51px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:300;box-shadow:0 2px 14px rgba(26,45,98,0.22);gap:10px;}
.header-left{display:flex;align-items:center;gap:12px;}
.app-title{font-family:'Orbitron',sans-serif;font-weight:900;font-size:13px;letter-spacing:3px;color:#a8c0ff;white-space:nowrap;}
.app-title span{color:#4ade80;}
.app-subtitle{font-size:9px;color:rgba(255,255,255,0.3);letter-spacing:1px;white-space:nowrap;}
.header-center{display:flex;align-items:center;}
.toggle-wrap{display:flex;border-radius:7px;overflow:hidden;border:1.5px solid rgba(255,255,255,0.2);background:rgba(255,255,255,0.07);}
.tbtn{font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;font-weight:700;padding:8px 18px;background:none;border:none;color:rgba(255,255,255,0.45);cursor:pointer;transition:all .2s;}
.tbtn.active{background:var(--ui-accent);color:#fff;}
.tbtn:not(.active):hover{color:#fff;}
.tbtn.merge-tab.active{background:linear-gradient(130deg,#7c3aed,#4f46e5);}
.header-right{display:flex;align-items:center;gap:8px;}
.visitor-badge{display:flex;align-items:center;gap:5px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:20px;padding:3px 10px 3px 7px;cursor:default;}
.visitor-icon{font-size:12px;}
.visitor-count{font-family:'Orbitron',sans-serif;font-size:9px;color:#a8c0ff;letter-spacing:1px;font-weight:700;}
.v-badge{font-size:9px;color:rgba(255,255,255,0.25);letter-spacing:1.5px;font-family:'Orbitron',sans-serif;white-space:nowrap;}
.hamburger{background:none;border:none;cursor:pointer;display:flex;flex-direction:column;justify-content:center;gap:4px;padding:6px;border-radius:6px;transition:background .2s;}
.hamburger:hover{background:rgba(255,255,255,0.1);}
.hamburger span{display:block;width:20px;height:2px;background:rgba(255,255,255,0.7);border-radius:2px;transition:all .3s;}
.hamburger.open span:nth-child(1){transform:translateY(6px) rotate(45deg);}
.hamburger.open span:nth-child(2){opacity:0;}
.hamburger.open span:nth-child(3){transform:translateY(-6px) rotate(-45deg);}
.dropdown-menu{position:fixed;top:51px;right:0;width:280px;background:#1e3060;border-left:1px solid rgba(255,255,255,0.1);border-bottom:1px solid rgba(255,255,255,0.1);border-radius:0 0 0 10px;box-shadow:-4px 4px 24px rgba(0,0,0,0.4);z-index:400;transform:translateX(100%);transition:transform .28s cubic-bezier(.4,0,.2,1);overflow:hidden;}
.dropdown-menu.open{transform:translateX(0);}
.dm-section{padding:14px 18px 8px;font-size:9px;font-weight:700;letter-spacing:2px;color:rgba(255,255,255,0.3);text-transform:uppercase;}
.dm-item{display:flex;align-items:center;gap:12px;padding:12px 18px;cursor:pointer;color:rgba(255,255,255,0.8);font-size:13px;font-weight:500;transition:background .15s;border:none;background:none;width:100%;text-align:left;}
.dm-item:hover{background:rgba(255,255,255,0.08);color:#fff;}
.dm-item .dm-icon{font-size:16px;width:22px;text-align:center;flex-shrink:0;}
.dm-item .dm-desc{font-size:10px;color:rgba(255,255,255,0.4);display:block;margin-top:1px;}
.dm-divider{height:1px;background:rgba(255,255,255,0.08);margin:6px 0;}
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:500;align-items:center;justify-content:center;padding:20px;}
.modal-bg.open{display:flex;}
.modal{background:#fff;border-radius:12px;width:100%;max-width:440px;box-shadow:0 20px 60px rgba(0,0,0,0.3);overflow:hidden;animation:modalIn .22s ease;}
@keyframes modalIn{from{opacity:0;transform:scale(.95);}to{opacity:1;transform:scale(1);}}
.modal-head{background:var(--ui-header);padding:16px 20px;display:flex;align-items:center;justify-content:space-between;}
.modal-head h3{color:#fff;font-size:14px;font-weight:700;letter-spacing:.5px;}
.modal-close{background:none;border:none;color:rgba(255,255,255,0.6);font-size:20px;cursor:pointer;line-height:1;padding:2px 6px;border-radius:4px;}
.modal-close:hover{color:#fff;background:rgba(255,255,255,0.1);}
.modal-body{padding:22px 20px;}
.dev-card{display:flex;align-items:center;gap:14px;margin-bottom:18px;}
.dev-avatar{width:54px;height:54px;border-radius:50%;background:linear-gradient(135deg,#2d54b8,#4ade80);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0;}
.dev-name{font-weight:700;font-size:15px;color:var(--ui-text);}
.dev-role{font-size:12px;color:var(--ui-muted);margin-top:2px;}
.dev-links{display:flex;flex-direction:column;gap:8px;}
.dev-link{display:flex;align-items:center;gap:10px;padding:10px 14px;border-radius:8px;background:var(--ui-sec-bg);color:var(--ui-accent);font-size:13px;font-weight:500;text-decoration:none;border:1.5px solid var(--ui-border);transition:all .15s;}
.dev-link:hover{background:var(--ui-accent);color:#fff;border-color:var(--ui-accent);}
.dev-link .dl-icon{font-size:15px;}
.rating-wrap{text-align:center;margin-bottom:16px;}
.stars{display:flex;justify-content:center;gap:8px;margin:14px 0 6px;}
.star{font-size:32px;cursor:pointer;transition:transform .1s;filter:grayscale(1);opacity:.4;}
.star.active{filter:none;opacity:1;transform:scale(1.15);}
.star:hover{transform:scale(1.2);}
.rating-label{font-size:12px;color:var(--ui-muted);min-height:18px;}
.comment-box{width:100%;border:1.5px solid var(--ui-input-b);border-radius:8px;padding:10px 12px;font-family:'Inter',sans-serif;font-size:13px;color:var(--ui-text);resize:vertical;min-height:80px;outline:none;transition:border-color .15s;}
.comment-box:focus{border-color:var(--ui-accent);box-shadow:0 0 0 3px rgba(45,84,184,0.1);}
.comment-label{font-size:11px;font-weight:600;color:var(--ui-muted);letter-spacing:.5px;margin-bottom:6px;display:block;text-transform:uppercase;}
.submit-btn{width:100%;margin-top:14px;padding:11px;background:linear-gradient(130deg,#2d54b8,#1a3880);border:none;border-radius:7px;color:#fff;font-family:'Inter',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s;}
.submit-btn:hover{opacity:.9;transform:translateY(-1px);}
.submit-success{text-align:center;padding:10px 0 4px;color:#16a34a;font-weight:600;font-size:13px;display:none;}

/* MAIN LAYOUT */
.app-layout{display:grid;grid-template-columns:350px 1fr;min-height:calc(100vh - 51px);}
.inp-panel{background:var(--ui-surface);border-right:1.5px solid var(--ui-border);padding:20px 18px 60px;overflow-y:auto;max-height:calc(100vh - 51px);}
.inp-panel::-webkit-scrollbar{width:5px;}
.inp-panel::-webkit-scrollbar-thumb{background:#c0ceeb;border-radius:10px;}
.sec-head{font-size:10px;font-weight:700;letter-spacing:2.5px;color:var(--ui-accent);text-transform:uppercase;padding:7px 10px;margin-bottom:11px;background:var(--ui-sec-bg);border-left:3px solid var(--ui-accent);border-radius:0 5px 5px 0;}
.sec-head-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:11px;}
.sec-head-row .sec-head{margin-bottom:0;flex:1;}
.copy-btn{flex-shrink:0;margin-left:8px;padding:4px 9px;background:#16a34a;border:none;border-radius:5px;color:#fff;font-family:'Inter',sans-serif;font-size:10px;font-weight:600;cursor:pointer;transition:all .2s;white-space:nowrap;box-shadow:0 2px 6px rgba(22,163,74,0.25);}
.copy-btn:hover{background:#0e7230;transform:translateY(-1px);}
.sgap{height:16px;}
.fg{margin-bottom:12px;}
.fg label{display:block;font-size:10.5px;font-weight:600;letter-spacing:1px;color:var(--ui-muted);margin-bottom:4px;text-transform:uppercase;}
.fg input{width:100%;background:#fff;border:1.5px solid var(--ui-input-b);border-radius:6px;color:var(--ui-text);font-family:'Inter',sans-serif;font-size:13.5px;font-weight:500;padding:8px 12px;outline:none;transition:border-color .15s,box-shadow .15s;}
.fg input:focus{border-color:var(--ui-accent);box-shadow:0 0 0 3px rgba(45,84,184,0.1);}
.fg input::placeholder{color:var(--ui-ph);}
.fg input[type="date"]{color-scheme:light;}
.fg .readonly-field{background:#f0f4fc;color:var(--ui-muted);border-color:#d8e2f4;cursor:default;font-style:italic;}
.dl-btn{width:100%;margin-top:20px;padding:13px;background:linear-gradient(130deg,#2d54b8,#1a3880);border:none;border-radius:7px;color:#fff;font-family:'Orbitron',sans-serif;font-size:11px;letter-spacing:2.5px;font-weight:700;cursor:pointer;transition:all .25s;box-shadow:0 4px 18px rgba(45,84,184,0.3);position:relative;overflow:hidden;}
.dl-btn::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.12),transparent);transition:left .4s;}
.dl-btn:hover::after{left:100%;}
.dl-btn:hover:not(:disabled){box-shadow:0 6px 26px rgba(45,84,184,0.42);transform:translateY(-1px);}
.dl-btn:disabled{opacity:.4;cursor:not-allowed;transform:none;background:linear-gradient(130deg,#7a8fbc,#4a5f8a);}
.dl-btn-wrap{position:relative;}
.dl-btn-tooltip{display:none;position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);background:#1a2540;color:#fff;font-family:'Inter',sans-serif;font-size:11px;font-weight:500;padding:7px 12px;border-radius:6px;white-space:nowrap;letter-spacing:0;pointer-events:none;box-shadow:0 4px 14px rgba(0,0,0,0.25);z-index:10;}
.dl-btn-tooltip::after{content:'';position:absolute;top:100%;left:50%;transform:translateX(-50%);border:5px solid transparent;border-top-color:#1a2540;}
.dl-btn-wrap:hover .dl-btn-tooltip{display:block;}
.mode-panel{display:none;}
.mode-panel.active{display:block;}
.prev-panel{background:#3a3a3a;display:flex;flex-direction:column;align-items:center;padding:28px 20px 40px;overflow-y:auto;max-height:calc(100vh - 51px);}
.prev-label{color:rgba(255,255,255,0.38);font-size:9px;letter-spacing:2.5px;margin-bottom:14px;font-family:'Orbitron',sans-serif;}

/* COVER PAGE STYLES */
.cv-page{width:210mm;min-height:296mm;background:#ffffff;position:relative;}
#cover-page{box-shadow:0 16px 60px rgba(0,0,0,0.55);margin:0 auto;}
.cv-border{position:absolute;top:16px;left:16px;right:19px;bottom:16px;border:1.5px solid #444;pointer-events:none;z-index:10;}
.cv-wm{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:420px;height:420px;background-image:url('img/watermark.jpg');background-size:contain;background-repeat:no-repeat;background-position:center;opacity:0.075;z-index:1;pointer-events:none;}
.cv-body{position:relative;z-index:5;padding:36px 55px 40px 55px;min-height:1018px;display:flex;flex-direction:column;font-family:'Calibri','Carlito',Arial,sans-serif;color:#000;}
.cv-logo{display:flex;align-items:center;justify-content:center;margin-bottom:10px;padding-top:20px;}
.cv-logo img{height:120px;width:auto;display:block;}
.cv-title{font-family:'Nirmala UI','Segoe UI','Trebuchet MS',Arial,sans-serif;font-size:27px;font-weight:700;text-decoration:underline;text-align:center;color:#000;margin:0 0 20px 0;}
.cv-row{display:block;margin-bottom:9px;line-height:1.5;}
.cv-lbl{font-family:'Calibri','Carlito',Arial,sans-serif;font-size:21px;font-weight:700;color:#000;display:inline;}
.cv-val{font-family:'Calibri','Carlito',Arial,sans-serif;font-size:21px;font-weight:400;color:#000;display:inline;}
.cv-sec{font-family:'Calibri','Carlito',Arial,sans-serif;font-size:21px;font-weight:700;color:#000;margin:18px 0 6px 0;}
.cv-ib{padding-left:110px;}
.cv-ir{display:block;margin-bottom:10px;margin-top:10px;line-height:1.5;}
.cv-il{font-family:'Calibri','Carlito',Arial,sans-serif;font-size:19px;font-weight:400;color:#000;display:inline;}
.cv-iv{font-family:'Calibri','Carlito',Arial,sans-serif;font-size:21px;font-weight:400;color:#000;display:inline;}
.cv-iv-name{font-size:23px!important;font-weight:400!important;position:relative;top:1px;}
.cv-uline{font-family:'Calibri','Carlito',Arial,sans-serif;font-size:20px;color:#000;margin-bottom:5px;padding-left:0;}
.cv-date-row{display:block;margin-top:12px;margin-bottom:6px;line-height:1.5;}
.cv-date-row .cv-lbl u{text-decoration:underline;}
.cv-date-row .cv-val{font-size:22px;}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MERGE PDF STYLES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
.merge-view{display:none;width:100%;min-height:calc(100vh - 51px);background:var(--ui-bg);flex-direction:column;overflow-y:auto;}
.merge-view.active{display:flex;}

.merge-topbar{background:linear-gradient(135deg,#1a2d62 0%,#2d1b69 100%);padding:18px 28px;display:flex;align-items:center;justify-content:space-between;gap:14px;flex-wrap:wrap;border-bottom:2px solid rgba(124,58,237,0.3);flex-shrink:0;}
.merge-topbar-title{font-family:'Orbitron',sans-serif;font-size:12px;font-weight:900;letter-spacing:3px;color:#c4b5fd;}
.merge-topbar-title span{color:#4ade80;}
.merge-topbar-desc{font-size:11px;color:rgba(255,255,255,0.4);margin-top:3px;letter-spacing:.5px;}

.merge-dropzone-wrap{padding:20px 28px 0;flex-shrink:0;}
.merge-dropzone{border:2.5px dashed #b0c2e8;border-radius:14px;background:#f4f7fd;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:28px 20px;cursor:pointer;transition:all .2s;text-align:center;position:relative;}
.merge-dropzone.over{border-color:#2d54b8;background:#e8eeff;box-shadow:0 0 0 4px rgba(45,84,184,0.12);}
.merge-dropzone input[type=file]{position:absolute;inset:0;opacity:0;cursor:pointer;width:100%;height:100%;}
.dz-icon{font-size:34px;margin-bottom:8px;}
.dz-text{font-size:13px;font-weight:600;color:var(--ui-muted);}
.dz-sub{font-size:11px;color:var(--ui-ph);margin-top:3px;}

.merge-cards-wrap{padding:20px 28px;flex:1;}
.merge-cards-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;gap:10px;flex-wrap:wrap;}
.merge-cards-title{font-size:10px;font-weight:700;letter-spacing:2px;color:var(--ui-accent);text-transform:uppercase;}
.merge-cards-count{font-size:10px;color:var(--ui-muted);background:var(--ui-sec-bg);border:1px solid var(--ui-border);border-radius:20px;padding:2px 10px;}
.clear-btn{padding:4px 10px;background:#fee2e2;border:1px solid #fca5a5;border-radius:5px;color:#dc2626;font-size:10px;font-weight:600;cursor:pointer;transition:all .15s;font-family:'Inter',sans-serif;}
.clear-btn:hover{background:#dc2626;color:#fff;}

.merge-cards{display:flex;flex-wrap:wrap;gap:16px;min-height:60px;align-content:flex-start;}
.pdf-card{width:145px;background:#fff;border:2px solid var(--ui-border);border-radius:12px;overflow:hidden;cursor:grab;transition:box-shadow .2s,transform .2s,border-color .2s;position:relative;user-select:none;flex-shrink:0;}
.pdf-card:hover{box-shadow:0 8px 28px rgba(45,84,184,0.15);border-color:#93aee8;}
.pdf-card.dragging{opacity:.45;transform:scale(.96);cursor:grabbing;}
.pdf-card.drag-over{border-color:#7c3aed;box-shadow:0 0 0 3px rgba(124,58,237,0.22);transform:scale(1.02);}
.pdf-card.is-cover{border-color:#4ade80;}
.card-badge{position:absolute;top:6px;left:6px;font-size:8px;font-weight:700;letter-spacing:1px;text-transform:uppercase;background:var(--ui-accent);color:#fff;border-radius:4px;padding:2px 7px;z-index:5;}
.pdf-card.is-cover .card-badge{background:#16a34a;}
.card-remove{position:absolute;top:5px;right:5px;width:20px;height:20px;background:rgba(220,38,38,0.85);border:none;border-radius:50%;color:#fff;font-size:13px;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:5;transition:background .15s;}
.card-remove:hover{background:#dc2626;}
.card-thumb{width:100%;height:112px;background:#f0f4fc;display:flex;align-items:center;justify-content:center;overflow:hidden;}
.card-thumb canvas{width:100%!important;height:100%!important;object-fit:contain;}
.card-thumb-placeholder{font-size:30px;color:#b0c2e8;}
.card-info{padding:8px 10px 6px;}
.card-name{font-size:10px;font-weight:600;color:var(--ui-text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.card-pages{font-size:9px;color:var(--ui-muted);margin-top:2px;}
.card-arrows{display:flex;justify-content:center;gap:5px;padding:0 8px 8px;}
.arr-btn{flex:1;padding:4px 0;background:var(--ui-sec-bg);border:1px solid var(--ui-border);border-radius:5px;font-size:10px;cursor:pointer;transition:background .15s;color:var(--ui-accent);font-weight:700;}
.arr-btn:hover:not(:disabled){background:var(--ui-accent);color:#fff;border-color:var(--ui-accent);}
.arr-btn:disabled{opacity:.28;cursor:default;}

.merge-bottombar{background:var(--ui-surface);border-top:1.5px solid var(--ui-border);padding:14px 28px;display:flex;align-items:center;justify-content:space-between;gap:14px;flex-wrap:wrap;flex-shrink:0;}
.merge-info{font-size:12px;color:var(--ui-muted);}
.merge-info strong{color:var(--ui-accent);}
.merge-dl-btn{padding:12px 26px;background:linear-gradient(130deg,#7c3aed,#4f46e5);border:none;border-radius:8px;color:#fff;font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:2px;font-weight:700;cursor:pointer;transition:all .25s;box-shadow:0 4px 18px rgba(124,58,237,0.35);position:relative;overflow:hidden;white-space:nowrap;}
.merge-dl-btn::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.15),transparent);transition:left .4s;}
.merge-dl-btn:hover::after{left:100%;}
.merge-dl-btn:hover:not(:disabled){box-shadow:0 6px 26px rgba(124,58,237,0.5);transform:translateY(-1px);}
.merge-dl-btn:disabled{opacity:.38;cursor:not-allowed;transform:none;}

.merge-progress-wrap{padding:0 28px 10px;flex-shrink:0;}
.merge-progress{height:4px;background:rgba(124,58,237,0.12);border-radius:4px;overflow:hidden;display:none;}
.merge-progress.show{display:block;}
.merge-progress-bar{height:100%;background:linear-gradient(90deg,#7c3aed,#4ade80);border-radius:4px;width:0%;transition:width .3s;}

.cover-note{background:linear-gradient(135deg,#f0fdf4,#dcfce7);border:1px solid #86efac;border-radius:8px;padding:10px 14px;font-size:11px;color:#166534;margin-bottom:14px;display:flex;align-items:flex-start;gap:8px;}
.merge-empty{text-align:center;padding:48px 20px;color:var(--ui-ph);width:100%;}
.merge-empty-icon{font-size:50px;margin-bottom:12px;opacity:.35;}
.merge-empty-text{font-size:13px;font-weight:600;}
.merge-empty-sub{font-size:11px;margin-top:5px;}
.drag-hint{font-size:10px;color:var(--ui-ph);display:flex;align-items:center;gap:5px;}
.add-cover-btn{padding:10px 18px;background:linear-gradient(130deg,#16a34a,#0e7230);border:none;border-radius:7px;color:#fff;font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:1.5px;font-weight:700;cursor:pointer;transition:all .2s;box-shadow:0 3px 12px rgba(22,163,74,0.3);white-space:nowrap;}
.add-cover-btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 5px 18px rgba(22,163,74,0.4);}
.add-cover-btn:disabled{opacity:.5;cursor:not-allowed;}

/* RESPONSIVE */
@media(max-width:940px){
  .app-layout{grid-template-columns:1fr;}
  .inp-panel{max-height:none;border-right:none;border-bottom:1.5px solid var(--ui-border);}
  .prev-panel{max-height:none;padding:20px 10px 40px;}
  #cover-page{width:100%;max-width:720px;min-height:0;}
  #cover-page .cv-body{min-height:0;}
}
@media(max-width:700px){
  .header-center{display:none;}
  .app-subtitle{display:none;}
  .visitor-badge{padding:2px 6px;border-radius:12px;}
  .visitor-icon{font-size:10px;}
  .visitor-count{font-size:8px;letter-spacing:.5px;}
  .merge-topbar,.merge-dropzone-wrap,.merge-cards-wrap,.merge-bottombar,.merge-progress-wrap{padding-left:14px;padding-right:14px;}
}
@media(max-width:580px){
  header{padding:0 14px;}
  .app-title{font-size:11px;letter-spacing:2px;}
  .inp-panel{padding:14px 12px 60px;}
  #cover-page .cv-body{padding:24px 26px;}
  #cover-page .cv-logo img{height:80px;}
  #cover-page .cv-title{font-size:18px;}
  #cover-page .cv-lbl,#cover-page .cv-val{font-size:13px!important;}
  #cover-page .cv-il,#cover-page .cv-iv,#cover-page .cv-uline{font-size:12px!important;}
  #cover-page .cv-iv-name{font-size:14px!important;top:1px;}
  #cover-page .cv-sec{font-size:14px!important;}
  #cover-page .cv-ib{padding-left:26px;}
  #cover-page .cv-date-row .cv-val{font-size:13px!important;}
  .dropdown-menu{width:100%;}
  .pdf-card{width:128px;}
  .card-thumb{height:96px;}
}
@media(max-width:400px){
  #cover-page .cv-body{padding:18px;}
  #cover-page .cv-lbl,#cover-page .cv-val{font-size:11px!important;}
  #cover-page .cv-il,#cover-page .cv-iv,#cover-page .cv-uline{font-size:11px!important;}
  #cover-page .cv-iv-name{font-size:12px!important;top:1px;}
  #cover-page .cv-sec{font-size:12px!important;}
  #cover-page .cv-title{font-size:15px;}
}
</style>
</head>
<body>

<header>
  <div class="header-left">
    <div>
      <div class="app-title">DIU <span>COVER</span> CRAFT</div>
      <div class="app-subtitle">COVER PAGE GENERATOR</div>
    </div>
  </div>
  <div class="header-center">
    <div class="toggle-wrap">
      <button class="tbtn active" id="btn-a" onclick="setMode('assignment')">ASSIGNMENT</button>
      <button class="tbtn" id="btn-l" onclick="setMode('lab')">LAB REPORT</button>
      <button class="tbtn merge-tab" id="btn-m" onclick="setMode('merge')">‚äï MERGE PDF</button>
    </div>
  </div>
  <div class="header-right">
    <div class="visitor-badge" title="Total page loads">
      <span class="visitor-icon">üëÅ</span>
      <span class="visitor-count" id="visitorCount">0</span>
    </div>
    <span class="v-badge">v1.0</span>
    <button class="hamburger" id="hamburgerBtn" onclick="toggleMenu()" aria-label="Menu">
      <span></span><span></span><span></span>
    </button>
  </div>
</header>

<!-- DROPDOWN -->
<div class="dropdown-menu" id="dropdownMenu">
  <div class="dm-section">Navigation</div>
  <button class="dm-item" onclick="openModal('devModal')">
    <span class="dm-icon">üë®‚Äçüíª</span>
    <div><div>Developer Info</div><span class="dm-desc">About the creator &amp; links</span></div>
  </button>
  <div class="dm-divider"></div>
  <button class="dm-item" onclick="openModal('ratingModal')">
    <span class="dm-icon">‚≠ê</span>
    <div><div>Comment &amp; Rating</div><span class="dm-desc">Share your feedback</span></div>
  </button>
  <div class="dm-divider"></div>
  <div class="dm-section" style="display:none" id="mobileModeSection">Switch Mode</div>
  <button class="dm-item" id="mobileToggleBtn" style="display:none" onclick="toggleModeFromMenu()">
    <span class="dm-icon">üîÑ</span>
    <div><div id="mobileToggleLabel">Switch to Lab Report</div><span class="dm-desc">Toggle assignment / lab report</span></div>
  </button>
</div>

<!-- MODALS -->
<div class="modal-bg" id="devModal" onclick="closeBg(event,'devModal')">
  <div class="modal">
    <div class="modal-head"><h3>üë®‚Äçüíª Developer Info</h3><button class="modal-close" onclick="closeModal('devModal')">√ó</button></div>
    <div class="modal-body">
      <div class="dev-card">
        <div class="dev-avatar">üßë‚Äçüíª</div>
        <div><div class="dev-name">Sifatur Rahman Imran</div><div class="dev-role">Full Stack Developer ¬∑ DIU Student</div></div>
      </div>
      <div class="dev-links">
        <a class="dev-link" href="https://sr-imran.github.io/sri/" target="_blank"><span class="dl-icon">üåê</span> Portfolio Website</a>
        <a class="dev-link" href="https://github.com/SR-iMrAN?tab=repositories" target="_blank"><span class="dl-icon">üêô</span> GitHub Profile</a>
        <a class="dev-link" href="https://www.linkedin.com/in/s-r-imran/" target="_blank"><span class="dl-icon">üíº</span> LinkedIn</a>
        <a class="dev-link" href="mailto:srimran423@gmail.com"><span class="dl-icon">‚úâÔ∏è</span> Contact via Email</a>
      </div>
    </div>
  </div>
</div>

<div class="modal-bg" id="ratingModal" onclick="closeBg(event,'ratingModal')">
  <div class="modal">
    <div class="modal-head"><h3>‚≠ê Comment &amp; Rating</h3><button class="modal-close" onclick="closeModal('ratingModal')">√ó</button></div>
    <div class="modal-body">
      <div class="rating-wrap">
        <div style="font-size:14px;font-weight:600;color:var(--ui-text);">How would you rate DIU Cover Craft?</div>
        <div class="stars" id="stars">
          <span class="star" data-v="1" onclick="setRating(1)">‚òÖ</span>
          <span class="star" data-v="2" onclick="setRating(2)">‚òÖ</span>
          <span class="star" data-v="3" onclick="setRating(3)">‚òÖ</span>
          <span class="star" data-v="4" onclick="setRating(4)">‚òÖ</span>
          <span class="star" data-v="5" onclick="setRating(5)">‚òÖ</span>
        </div>
        <div class="rating-label" id="ratingLabel">Click a star to rate</div>
      </div>
      <label class="comment-label">Your Comment</label>
      <textarea class="comment-box" id="commentBox" placeholder="Share your thoughts, suggestions, or feedback..."></textarea>
      <button class="submit-btn" onclick="submitRating()">Submit Feedback</button>
      <div class="submit-success" id="submitSuccess">‚úÖ Thank you for your feedback!</div>
    </div>
  </div>
</div>

<!-- MAIN COVER/LAB LAYOUT -->
<div class="app-layout" id="mainLayout">
  <div class="inp-panel">
    <div class="mode-panel active" id="panel-assignment">
      <div class="sec-head">üìÑ Document Info</div>
      <div class="fg"><label>Topic Name</label><input type="text" id="a_topicName" placeholder="e.g. SQL SELECT, Query and Sub Query" oninput="render()"></div>
      <div class="fg"><label>Course Code</label><input type="text" id="a_courseCode" placeholder="e.g. CSE311" oninput="render()"></div>
      <div class="fg"><label>Course Title</label><input type="text" id="a_courseTitle" placeholder="e.g. Database Management System" oninput="render()"></div>
      <div class="sgap"></div>
      <div class="sec-head">üë®‚Äçüè´ Submitted To</div>
      <div class="fg"><label>Teacher Name</label><input type="text" id="a_tName" placeholder="e.g. Ada Lovelace, Alan Turing" oninput="render()"></div>
      <div class="fg"><label>Department</label><input type="text" id="a_tDept" placeholder="e.g. CSE" oninput="render()"></div>
      <div class="fg"><label>University (Fixed)</label><input class="readonly-field" type="text" value="Daffodil International University." readonly></div>
      <div class="sgap"></div>
      <div class="sec-head">üéì Submitted By</div>
      <div class="fg"><label>Your Name</label><input type="text" id="a_sName" placeholder="e.g. Imran Sifat" oninput="render()"></div>
      <div class="fg"><label>Student ID</label><input type="text" id="a_sId" placeholder="e.g. 241-15-001" oninput="render()"></div>
      <div class="fg"><label>Section</label><input type="text" id="a_sSec" placeholder="e.g. 66_I" oninput="render()"></div>
      <div class="fg"><label>Semester</label><input type="text" id="a_sSem" placeholder="e.g. Spring 2026" oninput="render()"></div>
      <div class="fg"><label>Department</label><input type="text" id="a_sDept" placeholder="e.g. CSE" oninput="render()"></div>
      <div class="fg"><label>University</label><input class="readonly-field" type="text" value="Daffodil International University." readonly></div>
      <div class="sgap"></div>
      <div class="sec-head">üìÖ Submission Date</div>
      <div class="fg"><label>Date</label><input type="date" id="a_subDate" oninput="render()"></div>
    </div>

    <div class="mode-panel" id="panel-lab">
      <div class="sec-head">üìÑ Document Info</div>
      <div class="fg"><label>Experiment Name</label><input type="text" id="l_expName" placeholder="e.g. Study of Basic Logic Gates" oninput="render()"></div>
      <div class="fg"><label>Experiment No</label><input type="text" id="l_expNo" placeholder="e.g. 01" oninput="render()"></div>
      <div class="fg"><label>Course Code</label><input type="text" id="l_courseCode" placeholder="e.g. CSE311" oninput="render()"></div>
      <div class="fg"><label>Course Title</label><input type="text" id="l_courseTitle" placeholder="e.g. Database Management System" oninput="render()"></div>
      <div class="sgap"></div>
      <div class="sec-head-row">
        <div class="sec-head">üë®‚Äçüè´ Submitted To</div>
        <button class="copy-btn" onclick="copyFromAssignment()">‚ö° Copy from Assignment</button>
      </div>
      <div class="fg"><label>Teacher Name</label><input type="text" id="l_tName" placeholder="e.g. Grace Hopper, Tim Berners-Lee" oninput="render()"></div>
      <div class="fg"><label>Department</label><input type="text" id="l_tDept" placeholder="e.g. CSE" oninput="render()"></div>
      <div class="fg"><label>University (Fixed)</label><input class="readonly-field" type="text" value="Daffodil International University." readonly></div>
      <div class="sgap"></div>
      <div class="sec-head">üéì Submitted By</div>
      <div class="fg"><label>Your Name</label><input type="text" id="l_sName" placeholder="e.g. Imran Sifat" oninput="render()"></div>
      <div class="fg"><label>Student ID</label><input type="text" id="l_sId" placeholder="e.g. 241-15-001" oninput="render()"></div>
      <div class="fg"><label>Section</label><input type="text" id="l_sSec" placeholder="e.g. 66_I" oninput="render()"></div>
      <div class="fg"><label>Semester</label><input type="text" id="l_sSem" placeholder="e.g. Spring 2026" oninput="render()"></div>
      <div class="fg"><label>Department</label><input type="text" id="l_sDept" placeholder="e.g. CSE" oninput="render()"></div>
      <div class="fg"><label>University</label><input class="readonly-field" type="text" value="Daffodil International University." readonly></div>
      <div class="sgap"></div>
      <div class="sec-head">üìÖ Submission Date</div>
      <div class="fg"><label>Date</label><input type="date" id="l_subDate" oninput="render()"></div>
    </div>

    <div class="dl-btn-wrap">
      <div class="dl-btn-tooltip" id="dlTooltip">Fill at least all but 2 fields to download</div>
      <button class="dl-btn" id="dlBtn" onclick="downloadPDF()" disabled>‚¨á &nbsp; DOWNLOAD PDF</button>
    </div>
  </div>

  <div class="prev-panel">
    <div class="prev-label">LIVE PREVIEW ‚Äî COVER PAGE</div>
    <div id="cover-page" class="cv-page">
      <div class="cv-border"></div>
      <div class="cv-wm"></div>
      <div class="cv-body" id="cv-body"></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     MERGE PDF VIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="merge-view" id="mergeView">

  <div class="merge-topbar">
    <div>
      <div class="merge-topbar-title">‚äï MERGE <span>PDF</span></div>
      <div class="merge-topbar-desc">Combine your cover page with any PDF ¬∑ Drag cards or use arrows to reorder ¬∑ Download as one file</div>
    </div>
    <button class="add-cover-btn" id="addCoverBtn" onclick="addCoverToPile()">Ôºã ADD MY COVER PAGE</button>
  </div>

  <div class="merge-dropzone-wrap">
    <div class="merge-dropzone" id="mergeDropzone">
      <input type="file" id="mergeFileInput" accept="application/pdf" multiple onchange="handleMergeFiles(this.files)">
      <div class="dz-icon">üìÇ</div>
      <div class="dz-text">Drop PDF files here, or click to browse</div>
      <div class="dz-sub">Multiple files supported ¬∑ Any PDF works</div>
    </div>
  </div>

  <div class="merge-cards-wrap">
    <div id="coverNoteWrap" style="display:none">
      <div class="cover-note">
        <span style="font-size:15px;flex-shrink:0">üü¢</span>
        <span>Your <strong>generated cover page</strong> has been added. Drag it left/right or use the arrows to reorder, then hit Download Merged PDF.</span>
      </div>
    </div>
    <div class="merge-cards-header">
      <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
        <span class="merge-cards-title">üìë PDF Queue</span>
        <span class="merge-cards-count" id="cardCount">0 files</span>
        <span class="drag-hint" id="dragHint" style="display:none">‚ò∞ Drag cards to reorder</span>
      </div>
      <button class="clear-btn" id="clearBtn" onclick="clearAll()" style="display:none">‚úï Clear All</button>
    </div>
    <div class="merge-cards" id="mergeCards">
      <div class="merge-empty" id="mergeEmpty">
        <div class="merge-empty-icon">üóÇÔ∏è</div>
        <div class="merge-empty-text">No PDFs yet</div>
        <div class="merge-empty-sub">Drop files above, or click "Add My Cover Page" to start</div>
      </div>
    </div>
  </div>

  <div class="merge-progress-wrap">
    <div class="merge-progress" id="mergeProgress">
      <div class="merge-progress-bar" id="mergeProgressBar"></div>
    </div>
  </div>

  <div class="merge-bottombar">
    <div class="merge-info" id="mergeInfo">Add at least 2 PDFs to merge</div>
    <button class="merge-dl-btn" id="mergeDlBtn" onclick="doMerge()" disabled>‚¨á &nbsp; DOWNLOAD MERGED PDF</button>
  </div>

</div>

<script>
/* PDF.js worker */
if(window.pdfjsLib) pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

let mode='assignment';
let currentRating=0;
let lastModeBeforeMerge='assignment';

/* VISITOR COUNTER */
(function(){
  try{
    const KEY='diu_cover_craft_visitors';
    let c=parseInt(localStorage.getItem(KEY)||'0',10);
    c++;localStorage.setItem(KEY,c);
    const el=document.getElementById('visitorCount');
    if(el){let s=Math.max(0,c-8);const t=()=>{if(s<=c){el.textContent=s;s++;setTimeout(t,60);}};t();}
  }catch(e){try{document.getElementById('visitorCount').textContent='‚Äî';}catch(_){}}
})();

/* FIELD VALIDATION */
const REQUIRED_FIELDS={
  assignment:['a_topicName','a_courseCode','a_courseTitle','a_tName','a_tDept','a_sName','a_sId','a_sSec','a_sSem','a_sDept','a_subDate'],
  lab:['l_expName','l_expNo','l_courseCode','l_courseTitle','l_tName','l_tDept','l_sName','l_sId','l_sSec','l_sSem','l_sDept','l_subDate']
};
function checkFields(){
  if(mode==='merge')return;
  const fields=REQUIRED_FIELDS[mode];
  let empty=0;
  fields.forEach(id=>{const el=document.getElementById(id);if(!el||!el.value.trim())empty++;});
  const btn=document.getElementById('dlBtn'),tip=document.getElementById('dlTooltip');
  const ok=empty<=2;btn.disabled=!ok;
  tip.textContent=ok?'':`Fill ${empty-2} more field${empty-2>1?'s':''} to enable download`;
}

/* MODE SWITCHER */
function setMode(m){
  if(m!=='merge')lastModeBeforeMerge=m;
  mode=m;
  document.getElementById('btn-a').className='tbtn'+(m==='assignment'?' active':'');
  document.getElementById('btn-l').className='tbtn'+(m==='lab'?' active':'');
  document.getElementById('btn-m').className='tbtn merge-tab'+(m==='merge'?' active':'');
  document.getElementById('panel-assignment').className='mode-panel'+(m==='assignment'?' active':'');
  document.getElementById('panel-lab').className='mode-panel'+(m==='lab'?' active':'');
  document.getElementById('mainLayout').style.display=m==='merge'?'none':'grid';
  document.getElementById('mergeView').className='merge-view'+(m==='merge'?' active':'');
  if(m!=='merge'){document.getElementById('mobileToggleLabel').textContent=m==='assignment'?'Switch to Lab Report':'Switch to Assignment';render();}
}

function toggleMenu(){
  const btn=document.getElementById('hamburgerBtn'),menu=document.getElementById('dropdownMenu');
  const o=menu.classList.contains('open');
  btn.classList.toggle('open',!o);menu.classList.toggle('open',!o);
  const mob=window.innerWidth<=700;
  document.getElementById('mobileModeSection').style.display=mob?'block':'none';
  document.getElementById('mobileToggleBtn').style.display=mob?'flex':'none';
}
function closeMenu(){document.getElementById('hamburgerBtn').classList.remove('open');document.getElementById('dropdownMenu').classList.remove('open');}
document.addEventListener('click',e=>{
  const menu=document.getElementById('dropdownMenu'),btn=document.getElementById('hamburgerBtn');
  if(menu.classList.contains('open')&&!menu.contains(e.target)&&!btn.contains(e.target))closeMenu();
});
function toggleModeFromMenu(){setMode(mode==='assignment'?'lab':'assignment');closeMenu();}
function openModal(id){closeMenu();document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
function closeBg(e,id){if(e.target===document.getElementById(id))closeModal(id);}

const ratingLabels=['','Awful üòû','Not great üòï','OK üòê','Good üòä','Excellent! üéâ'];
function setRating(v){
  currentRating=v;
  document.querySelectorAll('.star').forEach(s=>s.classList.toggle('active',parseInt(s.dataset.v)<=v));
  document.getElementById('ratingLabel').textContent=ratingLabels[v];
}
function submitRating(){
  if(!currentRating){document.getElementById('ratingLabel').textContent='‚ö†Ô∏è Please select a rating first';return;}
  document.getElementById('submitSuccess').style.display='block';
  setTimeout(()=>{closeModal('ratingModal');document.getElementById('submitSuccess').style.display='none';document.getElementById('commentBox').value='';currentRating=0;setRating(0);},2000);
}
function copyFromAssignment(){
  ['courseCode','courseTitle','tName','tDept','sName','sId','sSec','sSem','sDept','subDate'].forEach(f=>{
    const src=document.getElementById('a_'+f),dst=document.getElementById('l_'+f);
    if(src&&dst)dst.value=src.value;
  });render();
}

function g(id){const e=document.getElementById(id);return e?e.value.trim():'';}
function gm(f){
  const m=mode==='merge'?lastModeBeforeMerge:mode;
  return g((m==='assignment'?'a_':'l_')+f);
}
function fd(s){
  if(!s)return'';
  const d=new Date(s+'T12:00:00');
  return String(d.getDate()).padStart(2,'0')+'/'+String(d.getMonth()+1).padStart(2,'0')+'/'+d.getFullYear();
}
function row(l,v){return`<div class="cv-row"><span class="cv-lbl">${l} </span><span class="cv-val">${v||''}</span></div>`;}
function irow(l,v,b=false){return`<div class="cv-ir"><span class="cv-il">${l} </span><span class="cv-iv${b?' cv-iv-name':''}">${v||''}</span></div>`;}

function buildHTML(){
  const m=mode==='merge'?lastModeBeforeMerge:mode;
  const isLab=m==='lab';
  let h='';
  h+=`<div class="cv-logo"><img src="img/DIU-Logo.png" alt="DIU" onerror="this.style.display='none'"></div>`;
  h+=`<div class="cv-title">${isLab?'LAB REPORT':'Assignment'}</div>`;
  if(!isLab)h+=row('Topic Name:',gm('topicName'));
  else{h+=row('Experiment Name:',gm('expName'));h+=row('Experiment No:',gm('expNo'));}
  h+=row('Course Code:',gm('courseCode'));
  h+=row('Course Title:',gm('courseTitle'));
  h+=`<div class="cv-sec"><u>Submitted To</u>:</div><div class="cv-ib">
    ${irow('Teacher Name:',gm('tName'),true)}
    ${irow('Department:',gm('tDept'))}
    <div class="cv-uline">Daffodil International University.</div>
  </div>`;
  h+=`<div class="cv-sec"><u>Submitted By</u>:</div><div class="cv-ib">
    ${irow('Name:',gm('sName'),true)}
    ${irow('ID:',gm('sId'))}
    ${irow('Section:',gm('sSec'))}
    ${irow('Semester:',gm('sSem'))}
    ${irow('Department:',gm('sDept'))}
    <div class="cv-uline">Daffodil International University.</div>
  </div>`;
  h+=`<div style="height:26px"></div>`;
  h+=`<div class="cv-date-row"><span class="cv-lbl"><u>Submission Date</u>: </span><span class="cv-val">${fd(gm('subDate'))}</span></div>`;
  return h;
}

function render(){
  document.getElementById('cv-body').innerHTML=buildHTML();
  checkFields();
}

/* PDF DOWNLOAD (cover only) */
async function toDataURL(url){
  try{
    const res=await fetch(url,{mode:'cors'});
    const blob=await res.blob();
    return await new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(blob);});
  }catch(e){return null;}
}

async function buildCoverPDFBlob(){
  const wrapper=document.createElement('div');
  wrapper.style.cssText='position:absolute;top:0;left:0;width:793px;height:1122px;overflow:hidden;visibility:hidden;pointer-events:none;z-index:-9999;';
  wrapper.innerHTML=`
    <div id="pci" style="width:793px;height:1122px;background:#fff;position:relative;font-family:'Calibri','Carlito',Arial,sans-serif;color:#000;">
      <div style="position:absolute;top:16px;left:22px;right:22px;bottom:16px;border:1.5px solid #444;z-index:10;margin-right:2px;"></div>
      <div id="pwm" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:420px;height:420px;background-image:url('img/watermark.jpg');background-size:contain;background-repeat:no-repeat;background-position:center;opacity:0.075;z-index:1;"></div>
      <div style="position:relative;z-index:5;padding:36px 55px 40px 55px;display:flex;flex-direction:column;">${buildHTML()}</div>
    </div>`;
  document.body.appendChild(wrapper);
  const cl=wrapper.querySelector('#pci');
  const st=document.createElement('style');
  st.textContent='.cv-iv-name{font-size:23px!important;font-weight:400!important;position:relative;top:2px;}';
  cl.appendChild(st);
  try{const lg=cl.querySelector('.cv-logo img');if(lg&&lg.src&&!lg.src.startsWith('data:')){const d=await toDataURL(lg.src);if(d)lg.src=d;}}catch(e){}
  try{const wm=cl.querySelector('#pwm');if(wm){const bg=wm.style.backgroundImage;const m=bg.match(/url\(['"]?(.*?)['"]?\)/);if(m&&m[1]&&!m[1].startsWith('data:')){const d=await toDataURL(m[1]);if(d)wm.style.backgroundImage=`url(${d})`;}}}catch(e){}
  await new Promise(r=>setTimeout(r,80));
  const opt={margin:0,image:{type:'jpeg',quality:1},html2canvas:{scale:3,useCORS:true,allowTaint:true,logging:false,width:794,height:1122,scrollX:0,scrollY:0},jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}};
  const blob=await html2pdf().set(opt).from(cl).outputPdf('blob');
  document.body.removeChild(wrapper);
  return blob;
}

async function downloadPDF(){
  const btn=document.getElementById('dlBtn');
  if(btn.disabled)return;
  btn.textContent='‚è≥  Generating...';btn.disabled=true;
  try{
    const blob=await buildCoverPDFBlob();
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;a.download=(lastModeBeforeMerge==='lab'?'Lab_Report':'Assignment')+'_Cover_DIU.pdf';
    a.click();URL.revokeObjectURL(url);
    btn.textContent='‚úì  Downloaded!';
    setTimeout(()=>{btn.textContent='‚¨á  DOWNLOAD PDF';checkFields();},2000);
  }catch(e){btn.textContent='‚¨á  DOWNLOAD PDF';checkFields();}
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MERGE PDF LOGIC
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let mergeItems=[];
let dragSrcIdx=null;

const mergeCardsEl=document.getElementById('mergeCards');
const mergeEmptyEl=document.getElementById('mergeEmpty');

/* Dropzone drag events */
const dz=document.getElementById('mergeDropzone');
['dragenter','dragover'].forEach(ev=>dz.addEventListener(ev,e=>{e.preventDefault();dz.classList.add('over');}));
dz.addEventListener('dragleave',()=>dz.classList.remove('over'));
dz.addEventListener('drop',e=>{
  e.preventDefault();dz.classList.remove('over');
  const files=[...e.dataTransfer.files].filter(f=>f.type==='application/pdf');
  if(files.length)handleMergeFiles(files);
});

async function handleMergeFiles(files){
  for(const f of files){
    const bytes=new Uint8Array(await f.arrayBuffer());
    const id='f'+Date.now()+Math.random();
    let pageCount=1,thumb=null;
    try{
      const pdf=await pdfjsLib.getDocument({data:bytes.slice()}).promise;
      pageCount=pdf.numPages;
      const page=await pdf.getPage(1);
      const vp=page.getViewport({scale:0.42});
      const canvas=document.createElement('canvas');
      canvas.width=vp.width;canvas.height=vp.height;
      await page.render({canvasContext:canvas.getContext('2d'),viewport:vp}).promise;
      thumb=canvas;
    }catch(e){}
    mergeItems.push({id,name:f.name,bytes,pageCount,isCover:false,thumb});
  }
  // Reset file input so same file can be added again if needed
  document.getElementById('mergeFileInput').value='';
  renderMergeCards();
}

async function addCoverToPile(){
  mergeItems=mergeItems.filter(x=>!x.isCover);
  const btn=document.getElementById('addCoverBtn');
  btn.textContent='‚è≥ Generating...';btn.disabled=true;
  try{
    const blob=await buildCoverPDFBlob();
    const bytes=new Uint8Array(await blob.arrayBuffer());
    let thumb=null;
    try{
      const pdf=await pdfjsLib.getDocument({data:bytes.slice()}).promise;
      const page=await pdf.getPage(1);
      const vp=page.getViewport({scale:0.42});
      const canvas=document.createElement('canvas');
      canvas.width=vp.width;canvas.height=vp.height;
      await page.render({canvasContext:canvas.getContext('2d'),viewport:vp}).promise;
      thumb=canvas;
    }catch(e){}
    mergeItems.unshift({id:'cover',name:'Cover Page (Generated)',bytes,pageCount:1,isCover:true,thumb});
    document.getElementById('coverNoteWrap').style.display='block';
    renderMergeCards();
  }catch(e){alert('Could not generate cover. Please fill in your cover details first (go to Assignment or Lab Report tab).');}
  btn.textContent='Ôºã ADD MY COVER PAGE';btn.disabled=false;
}

function renderMergeCards(){
  mergeCardsEl.innerHTML='';
  const total=mergeItems.reduce((a,x)=>a+x.pageCount,0);
  const hasItems=mergeItems.length>0;

  document.getElementById('cardCount').textContent=mergeItems.length+' file'+(mergeItems.length!==1?'s':'');
  document.getElementById('mergeDlBtn').disabled=mergeItems.length<2;
  document.getElementById('clearBtn').style.display=hasItems?'':'none';
  document.getElementById('dragHint').style.display=mergeItems.length>1?'flex':'none';

  if(!hasItems){
    mergeCardsEl.appendChild(mergeEmptyEl);
    document.getElementById('coverNoteWrap').style.display='none';
    document.getElementById('mergeInfo').textContent='Add at least 2 PDFs to merge';
    return;
  }

  document.getElementById('mergeInfo').innerHTML=`<strong>${mergeItems.length} PDF${mergeItems.length!==1?'s':''}</strong> ¬∑ ${total} page${total!==1?'s':''} total`;

  mergeItems.forEach((item,idx)=>{
    const card=document.createElement('div');
    card.className='pdf-card'+(item.isCover?' is-cover':'');
    card.draggable=true;
    card.dataset.idx=idx;

    const badge=document.createElement('div');
    badge.className='card-badge';
    badge.textContent=item.isCover?'COVER':'#'+(idx+1);
    card.appendChild(badge);

    const rm=document.createElement('button');
    rm.className='card-remove';rm.innerHTML='&times;';rm.title='Remove';
    rm.onclick=e=>{e.stopPropagation();mergeItems.splice(idx,1);if(item.isCover)document.getElementById('coverNoteWrap').style.display='none';renderMergeCards();};
    card.appendChild(rm);

    const thumb=document.createElement('div');
    thumb.className='card-thumb';
    if(item.thumb){
      const c=item.thumb.cloneNode(true);
      c.style.cssText='width:100%;height:100%;object-fit:contain;display:block;';
      thumb.appendChild(c);
    }else{
      thumb.innerHTML='<div class="card-thumb-placeholder">üìÑ</div>';
    }
    card.appendChild(thumb);

    const info=document.createElement('div');
    info.className='card-info';
    info.innerHTML=`<div class="card-name" title="${item.name}">${item.name}</div><div class="card-pages">${item.pageCount} page${item.pageCount!==1?'s':''}</div>`;
    card.appendChild(info);

    const arrows=document.createElement('div');
    arrows.className='card-arrows';
    const lb=document.createElement('button');
    lb.className='arr-btn';lb.textContent='‚óÄ';lb.title='Move left';lb.disabled=idx===0;
    lb.onclick=e=>{e.stopPropagation();[mergeItems[idx-1],mergeItems[idx]]=[mergeItems[idx],mergeItems[idx-1]];renderMergeCards();};
    const rb=document.createElement('button');
    rb.className='arr-btn';rb.textContent='‚ñ∂';rb.title='Move right';rb.disabled=idx===mergeItems.length-1;
    rb.onclick=e=>{e.stopPropagation();[mergeItems[idx],mergeItems[idx+1]]=[mergeItems[idx+1],mergeItems[idx]];renderMergeCards();};
    arrows.appendChild(lb);arrows.appendChild(rb);
    card.appendChild(arrows);

    /* Drag reorder */
    card.addEventListener('dragstart',e=>{dragSrcIdx=idx;card.classList.add('dragging');e.dataTransfer.effectAllowed='move';});
    card.addEventListener('dragend',()=>card.classList.remove('dragging'));
    card.addEventListener('dragover',e=>{e.preventDefault();card.classList.add('drag-over');});
    card.addEventListener('dragleave',()=>card.classList.remove('drag-over'));
    card.addEventListener('drop',e=>{
      e.preventDefault();card.classList.remove('drag-over');
      if(dragSrcIdx===null||dragSrcIdx===idx)return;
      const moved=mergeItems.splice(dragSrcIdx,1)[0];
      mergeItems.splice(idx,0,moved);
      dragSrcIdx=null;
      renderMergeCards();
    });

    mergeCardsEl.appendChild(card);
  });
}

function clearAll(){mergeItems=[];renderMergeCards();}

async function doMerge(){
  if(mergeItems.length<2)return;
  const btn=document.getElementById('mergeDlBtn');
  btn.textContent='‚è≥ Merging...';btn.disabled=true;

  const prog=document.getElementById('mergeProgress');
  const bar=document.getElementById('mergeProgressBar');
  prog.classList.add('show');bar.style.width='0%';

  try{
    const {PDFDocument}=PDFLib;
    const merged=await PDFDocument.create();
    for(let i=0;i<mergeItems.length;i++){
      bar.style.width=Math.round((i/mergeItems.length)*88)+'%';
      const src=await PDFDocument.load(mergeItems[i].bytes);
      const pages=await merged.copyPages(src,src.getPageIndices());
      pages.forEach(p=>merged.addPage(p));
    }
    bar.style.width='96%';
    const out=await merged.save();
    bar.style.width='100%';
    const blob=new Blob([out],{type:'application/pdf'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;a.download='DIU_Merged_Document.pdf';a.click();
    URL.revokeObjectURL(url);
    btn.textContent='‚úì  Downloaded!';
    setTimeout(()=>{btn.textContent='‚¨á  DOWNLOAD MERGED PDF';btn.disabled=mergeItems.length<2;prog.classList.remove('show');bar.style.width='0%';},2500);
  }catch(err){
    alert('Merge failed. Please make sure your PDFs are valid and not password-protected.');
    btn.textContent='‚¨á  DOWNLOAD MERGED PDF';btn.disabled=false;
    prog.classList.remove('show');
  }
}

render();
</script>
</body>
</html>